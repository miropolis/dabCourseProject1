---
import Layout from "../layout/Layout.astro";
import GradingButton from "../components/GradingButton.svelte";
import ProgrammingAssignment from "../components/ProgrammingAssignment.svelte";
import ProgrammingSubmissions from "../components/ProgrammingSubmissions.svelte";

export async function getStaticPaths() {
  const response = await fetch("http:/programming-api:7777/highest-assignment");
  const highestAssignmentJSON = await response.json();
  console.log("Highest Assignment from [assignment].astro: ", highestAssignmentJSON[0].count)
  let pagesArray = []
  for (let i=1; i<=highestAssignmentJSON[0].count; i++) {
    console.log(i)
    pagesArray.push({params: {assignment: 'assignment-'+i}});
    console.log(pagesArray)
  };
  
  return pagesArray;
}

const { assignment } = Astro.params;
const assignmentNumber = parseInt(assignment.slice(-1))
---
<Layout>
  <ProgrammingAssignment assignmentID={assignmentNumber} client:load />
  <GradingButton assignmentID={assignmentNumber} client:only={"svelte"} />
  <ProgrammingSubmissions assignmentID={assignmentNumber} client:load />
</Layout>
  